<!DOCTYPE html>
<html>
<head>
    <title>AJAX</title>
</head>
<body>
<pre>
XMLHttpRequest 对象 {

	属性:
	readyState//存有 XMLHttpRequest 的状态信息0: 请求未初始化1: 服务器连接已建2: 请求已接收3: 请求处理中4: 请求已完成，且响应已就绪
	onreadystatechange	存储函数（或函数的名称）在每次 readyState 属性变化时被自动调用。

	responseText	获得字符串形式的响应数据。responseText 属性返回字符串形式的响应，。
	responseXML	如果来自服务器的响应是 XML，而且需要作为 XML 对象进行解析
	status	返回状态数（例如 "404" 为 "Not Found" 或 "200" 为 "OK"）。
	statusText	返回状态文本（如 "Not Found" 或 "OK"）。


	方法:
	abort()	取消当前的请求。
	getAllResponseHeaders()	返回头信息。
	getResponseHeader()	返回指定的头信息。
	open(method,url,async,uname,pswd)	规定请求的类型，URL，请求是否应该进行异步处理，以及请求的其他可选属性。
						method：请求的类型：GET 或 POST
						url：文件在服务器上的位置
						async：true（异步）或 false（同步）
	send(string)	发送请求到服务器。string：仅用于 POST 请求
	setRequestHeader()	把标签/值对添加到要发送的头文件
}
</pre>
<script type="text/javascript">

    /** todo AJAX(XMLHttpRequest) 使用演示
     * */
    function ajaxDemo(){
        const xhr = new XMLHttpRequest(); // 创建 XMLHttpRequest 对象
        console.log('readyState: UNSENT: XMLHttpRequest 代理已被创建， 但尚未调用 open() 方法', xhr.readyState); // 0



        /** XMLHttpRequest 实例(xhr)事件 */
        xhr.onloadstart = function(){
            console.log('Event: onloadstart');
        };
        xhr.onprogress = function () {
            console.log('Event: onprogress');
            console.log('readyState: LOADING', xhr.readyState); // readyState 为 3
        };
        xhr.onabort = function(){
            console.log('Event: onabort');
        };
        xhr.onerror = function(){
            console.log('Event: onerror');
        };
        xhr.onload = function(){
            console.log('Event: onload');
            console.log('readyState: DONE', xhr.readyState); // readyState 为 4
        };
        xhr.ontimeout = function(){
            console.log('Event: ontimeout');
        };
        xhr.onloadend = function(){
            console.log('Event: onloadend');
        };
        xhr.onreadystatechange = function(){ // 2、设置 onreadystatechange 函数
            if(xhr.readyState === 4){
                if(xhr.status === 200){
                    var result = xhr.responseText; // 3、获取服务器返回的数据


                    /*数据类型为TXT时*/
                    document.getElementById("demo15").innerHTML = receive;

                    /*数据类型为XML时
                    var xmlRoot = receive.documentElement;
                    try {
                        var xmlItem = xmlRoot.getElementsByTagName("item");
                        alert(xmlItem.firstChild.nodeValue);
                    } catch(e) {
                        alert(e.message);
                    }
                    */

                    /* 数据类型为JSON字符串时
                    var obj = JSON.parse(receive);
                    document.getElementById("fname").innerHTML="FirstName"+obj.employees[0].lastName;
                    document.getElementById("lname").innerHTML="LastName"+obj.employees[1].lastName;
                    */
                }
            }
        };

        /** XMLHttpRequest 实例(xhr)属性 */
        /* xhr.readyState 各值含义
         * 0    UNSENT              XMLHttpRequest 代理已被创建，但尚未调用 open() 方法。
         * 1    OPENED              open() 方法已经被触发。在这个状态中，可以通过  setRequestHeader() 方法来设置请求的头部， 可以调用 send() 方法来发起请求
         * 2    HEADERS_RECEIVED    send() 方法已经被调用，响应头也已经被接收
         * 3    LOADING             响应体部分正在被接收，如果 responseType 属性是“text”或空字符串， responseText 将会在载入的过程中拥有部分响应数据
         * 4    DONE                请求操作已经完成。这意味着数据传输已经彻底完成或失败
         * */
        xhr.readyState;
        xhr.response;
        xhr.responseText;
        xhr.responseType;
        xhr.responseURL;
        xhr.responseXML;
        xhr.status;
        xhr.statusText;
        xhr.timeout;
        xhr.upload;
        xhr.withCredentials;

        /** XMLHttpRequest 实例(xhr)方法 */
        xhr.abort();
        xhr.getAllResponseHeaders();
        xhr.getResponseHeader("headerName");
        xhr.open();
        xhr.overrideMimeType();
        xhr.send();
        xhr.setRequestHeader("headerName", "headerValue");



        /* //GET请求 */
        xhr.open("GET",URI+"?q="+args+"&m=GET:",false);//true:表示该 ajax 异步提交；false：表示同步提交
        console.log('readyState: OPENED: open() 方法已经被触发。在这个状态中，可以通过  setRequestHeader() 方法来设置请求的头部， 可以调用 send() 方法来发起请求', xhr.readyState); // 1


        xhr.send();
        console.log('readyState: HEADERS_RECEIVED: send() 方法已经被调用，并且头部和状态已经可获得', xhr.readyState);


        /*  //POST请求
        xhr.open("POST",URI,true);
        //设置Content-Type类型为aapplication/x-www-form-urlencoded,以告知服务器实体中有参数
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send("q="+args+"&m=POST:");
        */

        /** 当ajax请求是同步时：xhr.onreadystatechange = function(){};内部执行完后才执行 function2();
         * 当ajax请求是异步时：浏览器不等 xhr.onreadystatechange = function(){}; 执行完就执行 function2();
         * */
        (function(){
            console.log('自动执行函数');
        })();
    }
</script>
</body>
</html>
